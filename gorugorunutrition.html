<script>
    document.addEventListener('DOMContentLoaded', function () {
        // WebSerial API 지원 여부 확인
        if ('serial' in navigator) {
            navigator.serial.requestPort().then(port => {
                return port.open({ baudRate: 9600 });
            }).then(port => {
                const reader = port.readable.getReader();
                return readLoop(reader);
            }).catch(err => {
                console.error('Error opening serial port:', err);
            });
        } else {
            console.error('Web Serial API is not supported in this browser.');
        }
    
        // 시리얼 데이터를 읽는 루프 함수
        async function readLoop(reader) {
            while (true) {
                const { value, done } = await reader.read();
                if (done) {
                    break;
                }
                const decodedText = new TextDecoder().decode(value).trim();
                handleRFIDTag(decodedText);  // 받은 태그 데이터를 처리
            }
        }
    
        // RFID 태그 데이터 처리 함수
        function handleRFIDTag(tag) {
            if (tag === "단백질1") {
                document.getElementById("nutritionblock").src = "bottomblock2.png";  // 영양소 블록 이미지 변경
                document.getElementById("info").innerText = "버터";  // 정보 텍스트 변경
            } else if (tag === "단백질2") {
                document.getElementById("info").innerText = "단백질 2 활성화";
            } else if (tag === "단백질3") {
                document.getElementById("info").innerText = "단백질 3 활성화";
            } else {
                document.getElementById("info").innerText = "알 수 없는 태그";
            }
        }
    
        // 테스트: 2초 후 "단백질1" 태그 감지 시뮬레이션
        setTimeout(() => {
            handleRFIDTag("단백질1");  // 단백질1 태그가 감지된 상황을 시뮬레이션
        }, 2000);
    });
</script>
