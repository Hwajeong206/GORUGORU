

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영양소 블록 화면</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    
    <style>
        @font-face {
            font-family: 'Happiness-Sans-Title';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2205@1.0/Happiness-Sans-Title.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Happiness-Sans-Title', sans-serif;
            background-color: #fee791;
            height: 100vh;
            display: flex;
            flex-direction: column;
            text-align: center;
            justify-content: space-between;
            overflow: hidden; /* 스크롤 차단 */
        }

        .container {
    position: relative;
    width: 100%;
    height: 100vh;            /* 전체 화면 높이 사용 */
    display: flex;
    flex-direction: column;   /* 수직 정렬 */
    justify-content: center;  /* 수직 가운데 정렬 */
    align-items: center;      /* 수평 가운데 정렬 */
}

        /* 상단 메뉴 버튼 */
        .menu-btn {
            position: absolute;
            top: 45px;
            left: 60px;
            width: 94.5px;
            height: 84px;
            background-color: white;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 수평 배치 */
        .horizontal-layout-nutrition {
            display: flex;
            position: relative;
            width: 100%;
            justify-content: center;  /* 수평 가운데 정렬 */
            align-items: center;      /* 수평 가운데 정렬 */
            gap: 450px;                /* 블록 사이 간격 */
}
        /* 영양소 표시 */
        .nutrition1, .nutrition2 {
            display: flex;
            padding: 0px 40px 0px 6px;
            align-items: center;
            gap: 16px;
            border-radius: 70px;
            max-width: 140px;
            margin-top: 20px; /* 추가: 영양소와의 간격 */
            position: relative;
        }

        .nutrition1 {
            background-color: #FFACAC; 
        }

        .info {
            font-family: "Happiness-Sans-Title";
            font-size: 35px;
            line-height: 143%;
            letter-spacing: -1px;
            border-radius: 70px;
            border: 1.5px solid #FFF;
            background: linear-gradient(180deg, #FFF 0%, rgba(255, 255, 255, 0) 100%);
            box-shadow: 4.876px 4.876px 48.762px 0px rgba(255, 184, 0, 0.50);
            padding: 16px 30px;
            text-align: center;
            color: black;
            margin-top: 20px; /* 이미지와 텍스트 사이의 간격 */
            width: 270px;
        }

        .nutrition2 {
            background-color: #83C0FE;
        }


        /* 이미지 크기 및 간격 설정 유지 */
        .nutrition1 img, .nutrition2 img {
            width: 80px;
            height: 80px;
            margin-right: -20px;
        }
        .nutrition1 span, .nutrition2 span {
            color: #FFF;
            font-family: "Happiness-Sans-Title";
            font-size: 34px;
            line-height: 143%;
            letter-spacing: -2.086px;
        }

        .horizontal-layout-images {
            display: flex;
            width: 100%;
            height: auto;
            position: relative;
            justify-content: center;  /* 수평 가운데 정렬 */
            align-items: center;
            gap: 80px;               /* 아보카도와 버터 이미지 간 간격 */
        
        }

        .blurimage1{
            align-items: center;
            position: relative;
           
        }

        .blurimage2 {
            align-items: center;
            position: relative;
          
        }

        .blurimage1 img, .blurimage2 img {
            max-width: 400px;
            width: 100%;
            height: auto;
            object-fit: contain; /* 이미지가 잘리지 않게 조정 */
            z-index: 1;
            filter: blur(15px); /* 블러 적용 */
            opacity: 0.7; /* 투명도 70% */  transition: filter 0.5s ease, opacity 0.5s ease; /* 전환 효과 */
        }

        .blurimage1 img:hover, .blurimage2 img:hover {
            filter: blur(0); /* 블러 제거 */
            opacity: 1; /* 투명도 100% */
        }



        /* 텍스트와 올리브 이미지 섹션 */
        .content {
            text-align: center;
            margin-top: -20px;
        }

        .content p {
            color: #000000;
            font-size: 70px;
            font-family: "Happiness-Sans-Title";
            line-height: 143%;
            letter-spacing: -3.36px;
            transition: font-size 1s, opacity 1s;
            margin-top: -110px;
        }

        /* 올리브 이미지 */
        .food img {
            margin-top: 20px;
            max-width: 600px;
            width: 100%;
            height: auto;
            object-fit: contain; /* 이미지가 잘리지 않게 조정 */
            z-index: 1;
            animation: float 3s ease-in-out infinite;
        }

        .nutritionblock img{
            max-width: 600px;
            width: 100%;
            height: auto;
            object-fit: contain; /* 이미지가 잘리지 않게 조정 */
            z-index: 1;
            position: relative;
            top: 100px;
            justify-content: center; /* 가운데 정렬 */
        }

        /* 블러 처리된 원 */
        .background-blur {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1500px;  /* 원 크기 확대 */
            height: 1500px;
            background-color: #ffdb26dd;
            border-radius: 50%;
            filter: blur(150px);  /* 블러 처리 */
            transform: translate(-50%, -50%);
            z-index: -1;  /* 다른 요소보다 뒤에 배치 */
        }


        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-30px);
            }
        }

        .info {
    transition: opacity 0.3s ease-in-out;
}

.info.fade-out {
    opacity: 0;
}

.info.fade-in {
    opacity: 1;
}

@media (min-width: 2560px) {
    .content p {
        font-size: 80px;  /* 타이틀 텍스트 크기 증가 */
    }
    .nutritionblock img {
        max-width: 800px;  /* 영양소 블록 이미지 크기 증가 */
    }
   
    .blurimage1 img, .blurimage2 img {
        max-width: 400px;  /* 블러 처리된 이미지 크기 확대 */
    }
    .food img {
        max-width: 800px;  /* 음식 이미지 크기 증가 */
    }
    .info {
        font-size: 40px;  /* 영양소 텍스트 크기 증가 */
    }
}

    /* 기존 CSS 스타일에 추가 */
    #serialButton {
        position: absolute;
            bottom: 50px; /* 원하는 위치 조정 */
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 100px; /* 원하는 높이 조정 */
            border: none;
            cursor: pointer;
            z-index: 2; /* 다른 요소 위에 보이도록 */
            opacity: 0;
    }


    </style>
</head>
<body>

<div class="container">
    <!-- 메뉴 버튼 -->
    <div class="menu-btn">
        <img src="menu2.svg" alt="menu" />
    </div>

    <!-- 블러 처리된 원 -->
    <div class="background-blur"></div>

    <!-- 타이틀 -->
    <div class="content">
        <p class="title">영양소 블록을 쌓아 음식을 만들어봐요!</p>


    
        <div class="horizontal-layout-images">

            <!-- 아이템 컨테이너 -->
    
            <!-- 아보카드 이미지 -->
            <div id="blurimage1" class="blurimage1">
                <img src="avocado.png" alt="아보카도" />
            </div>

            <div id="food" class="food">
                <img src="olive.png" alt="음식 이미지" />
            </div>    

            <!-- 버터 이미지 -->
            <div id="blurimage2" class="blurimage2">
                <img src="butter.png" alt="버터" />
            </div>
        </div>

        <div class="horizontal-layout-nutrition">
            <!-- 정보 표시 -->
             <!-- 영양소 up/down -->
            <div id="nutrition1" class="nutrition1">
                <img src="carbon.svg" alt="탄수화물"/>
                <span>-1</span>
            </div>

            <div id="info-text" class="info">올리브 오일</div>

            <div id="nutrition2" class="nutrition2">
                <img src="protein.svg" alt="단백질"/>
                <span>+1</span>
            </div>
        </div>


        <div id="image-block" class="nutritionblock"><img src="bottomblock0.png" alt="영양소 블록 이미지" /></div>

        <!-- 버튼 추가 -->
<button id="serialButton" onclick="handleButtonClick()">연결하기</button>

<script>
    let port;
    let reader;
    let currentTag = null; // 현재 태그를 저장할 변수
    let tagTimeout; // 태그 타임아웃 변수
    let lastTag = null; // 마지막에 읽힌 태그를 저장하는 변수
    let debounceTimer = null; // 타이머 변수
    const timeoutDuration = 15000; // 15초 (15,000ms) 타임아웃 시간

    const connectButton = document.getElementById('serialButton');
    const bottomBlockImage = document.getElementById("image-block").querySelector("img");
    const foodImage = document.getElementById("food").querySelector("img");
    const infoText = document.getElementById('info-text');
    const blurimage1Image = document.getElementById("blurimage1").querySelector("img");
    const blurimage2Image = document.getElementById("blurimage2").querySelector("img");
    const nutrition1 = document.getElementById("nutrition1");
    const nutrition2 = document.getElementById("nutrition2");

    // 페이지 로드 시 버튼을 보여줍니다.
    window.onload = () => {
        connectButton.style.display = "block"; // 버튼 보이기
    };

    connectButton.addEventListener('click', async () => {
        await connectToSerial();
    });

    async function connectToSerial() {
        try {
            port = await navigator.serial.requestPort(); // 포트 선택
            await port.open({ baudRate: 9600 }); // 시리얼 통신 설정
            reader = port.readable.getReader();

            connectButton.innerText = "연결됨";
            connectButton.disabled = true; // 버튼 비활성화

            await readFromSerial(); // 데이터 읽기 시작
        } catch (error) {
            console.error("시리얼 연결 에러:", error);
            connectButton.innerText = "연결 실패, 다시 시도";
        }
    }

    async function readFromSerial() {
        while (port.readable) {
            try {
                const { value, done } = await reader.read();
                if (done) {
                    console.log("리더 종료");
                    break;
                }
                const tag = new TextDecoder().decode(value).trim(); // RFID 태그 값 읽기
                console.log("받은 RFID 태그:", tag);
                   // "Failed to read card." 메시지를 RFID 태그로 전환
                   if (tag === 'Failed to read card.') {
                // 태그를 읽지 못했을 경우에도 마지막으로 읽힌 태그를 사용
                if (lastTag) {
                    currentTag = lastTag;
                    console.log("유효한 마지막 태그 사용:", lastTag);
                }
            } else {
                currentTag = tag; // 현재 태그 저장
                lastTag = tag; // 마지막 태그 업데이트
            }


                // 태그 인식 시 타이머 초기화
                resetTimeout();

                // 태그에 따른 이미지 및 텍스트 변경
                if (tag === '5390718B') {
                    bottomBlockImage.src = 'bottomblock1.png';
                    foodImage.src = 'butter.png';
                    infoText.innerText = '버터';
                    blurimage1Image.src = 'carrot.png'
                    blurimage2Image.src = 'cheese.png'
                    document.getElementById('nutrition1').querySelector('span').innerText = '+1';
                    document.getElementById('nutrition1').querySelector('img').src = 'vitamin.svg';
                    document.getElementById('nutrition2').querySelector('span').innerText = '+1';
                    document.getElementById('nutrition2').querySelector('img').src = 'protein.svg';
                    nutrition1.style.backgroundColor = '#86DC97'; // 예: 탄수화물 블럭 새로운 색상
                    nutrition2.style.backgroundColor = '#83C0FE'; // 예: 단백질 블럭 새로운 색상
                } else if (tag === 'C002D958') {
                    bottomBlockImage.src = 'bottomblock2.png';
                    foodImage.src = 'cheese.png';
                    infoText.innerText = '치즈';
                    blurimage1Image.src = 'sweetpotato.png'
                    blurimage2Image.src = 'pork.png'
                    document.getElementById('nutrition1').querySelector('span').innerText = '+1';
                    document.getElementById('nutrition1').querySelector('img').src = 'fat.svg';
                    document.getElementById('nutrition2').querySelector('span').innerText = '+1';
                    document.getElementById('nutrition2').querySelector('img').src = 'protein.svg';
                    nutrition1.style.backgroundColor = '#FFC93F'; // 예: 탄수화물 블럭 새로운 색상
                    nutrition2.style.backgroundColor = '#83C0FE'; // 예: 단백질 블럭 새로운 색상
                } else if (tag === 'C2765B54') {
                    bottomBlockImage.src = 'bottomblock3.png';
                    foodImage.src = 'pork.png';
                    infoText.innerText = '돼지고기';
                    blurimage1Image.src = 'brocoli.png'
                    blurimage2Image.src = 'friedpotato.png'
                    document.getElementById('nutrition1').querySelector('span').innerText = '+1';
                    document.getElementById('nutrition1').querySelector('img').src = 'vitamin.svg';
                    document.getElementById('nutrition2').querySelector('span').innerText = '+1';
                    document.getElementById('nutrition2').querySelector('img').src = 'protein.svg';
                    nutrition1.style.backgroundColor = '#86DC97'; // 예: 탄수화물 블럭 새로운 색상
                    nutrition2.style.backgroundColor = '#83C0FE'; // 예: 단백질 블럭 새로운 색상
                }

            } catch (error) {
                console.error("시리얼 읽기 에러:", error);
                break;
            }
        }
        reader.releaseLock(); // 리더 해제
    }

    function resetTimeout() {
        // 기존 타이머가 있으면 초기화
        clearTimeout(tagTimeout);

        // 새로운 타이머 설정 (1분 후에 원래 상태로 복원)
        tagTimeout = setTimeout(() => {
            resetToDefaultState();
        }, timeoutDuration);
    }

    function resetToDefaultState() {
        currentTag = null; // 태그 상태 초기화
        bottomBlockImage.src = 'bottomblock0.png'; // 원래 이미지로 복원
        foodImage.src = 'olive.png'; // 기본 음식 이미지로 복원
        infoText.innerText = '올리브 오일'; // 기본 텍스트로 복원
        blurimage1Image.src = 'avocado.png'
        blurimage2Image.src = 'butter.png'
        document.getElementById('nutrition1').querySelector('span').innerText = '+1';
        document.getElementById('nutrition1').querySelector('img').src = 'carbon.svg';
        document.getElementById('nutrition2').querySelector('span').innerText = '+1';
        document.getElementById('nutrition2').querySelector('img').src = 'protein.svg';
        nutrition1.style.backgroundColor = '#FFACAC'; // 예: 탄수화물 블럭 새로운 색상
        nutrition2.style.backgroundColor = '#83C0FE'; // 예: 단백질 블럭 새로운 색상
        console.log("태그가 없어서 원래 상태로 복원됨");
    }

    // 1초마다 태그 상태를 주기적으로 확인 (현재는 태그가 떼어진 상태는 감지하지 않음)
    setInterval(() => {
        if (!currentTag) {
            // 만약 현재 태그가 없다면 아무 작업도 하지 않음
        }
    }, 1000);

</script>

</body>
</html>

